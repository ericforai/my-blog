---
import { generateSVGBanner, type BlogPost, type BannerImageConfig } from '~/utils/bannerGenerator';

interface Props {
  post: BlogPost;
  config?: BannerImageConfig & {
    useAIImage?: boolean;
  };
  className?: string;
}

const { post, config = {
  width: 1200,
  height: 630,
  style: 'modern',
  colorScheme: 'gradient',
  useAIImage: false
}, className = '' } = Astro.props;

// 检查是否启用 AI 图片生成
const useAIImage = config.useAIImage && import.meta.env.OPENAI_API_KEY;

let bannerContent: string;

if (useAIImage) {
  try {
    // TODO: 实现 AI 图片生成逻辑
    // 目前先使用 SVG banner
    bannerContent = generateSVGBanner(post, config);
  } catch (error) {
    console.warn('AI image generation failed, falling back to SVG:', error);
    bannerContent = generateSVGBanner(post, config);
  }
} else {
  bannerContent = generateSVGBanner(post, config);
}
---

<div class={`banner-container ${className}`}>
  <div class="aspect-video rounded-lg overflow-hidden">
    <div class="banner-svg" set:html={bannerContent}></div>
  </div>
</div>

<style>
  .banner-container {
    width: 100%;
    height: 100%;
  }
  
  .banner-svg {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .banner-svg svg {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  
  /* Responsive adjustments */
  @media (max-width: 768px) {
    .banner-svg svg text {
      font-size: 0.8em;
    }
  }
</style>
